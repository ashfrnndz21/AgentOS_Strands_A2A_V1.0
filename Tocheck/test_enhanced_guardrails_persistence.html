<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Guardrails Persistence Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">Enhanced Guardrails Persistence Test</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Test Instructions -->
            <div class="bg-gray-800 p-6 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">üìã Test Instructions</h2>
                <div class="space-y-4 text-gray-300">
                    <p><strong>Step 1:</strong> Create a new agent with enhanced guardrails</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Go to Command Centre ‚Üí Create Agent</li>
                        <li>Fill in basic information</li>
                        <li>Go to Guardrails tab</li>
                        <li>Enable content filters</li>
                        <li>Add blocked keywords (e.g., "spam", "scam")</li>
                        <li>Add blocked phrases</li>
                        <li>Create custom rules</li>
                        <li>Save the agent</li>
                    </ul>
                    
                    <p><strong>Step 2:</strong> Verify the configuration is saved</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Go to Ollama Agent Management</li>
                        <li>Click on your newly created agent</li>
                        <li>Go to the Guardrails tab</li>
                        <li>Verify all your settings are displayed</li>
                    </ul>
                </div>
            </div>

            <!-- Expected Results -->
            <div class="bg-gray-800 p-6 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">‚úÖ Expected Results</h2>
                <div class="space-y-4 text-gray-300">
                    <div>
                        <h3 class="text-lg font-medium mb-2 text-blue-400">Basic Guardrails</h3>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Enabled: ‚úì (green checkmark)</li>
                            <li>Safety Level: medium (or your selection)</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-medium mb-2 text-purple-400">Enhanced Guardrails</h3>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Content Filter section visible</li>
                            <li>Blocked Keywords: Your keywords as red badges</li>
                            <li>Blocked Phrases: Your phrases as red badges</li>
                            <li>Custom Rules: Your rules with descriptions</li>
                            <li>Rule patterns and actions displayed</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Debug Information -->
        <div class="mt-8 bg-gray-800 p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-4">üêõ Debug Information</h2>
            <div class="bg-gray-700 p-4 rounded">
                <p class="text-gray-300 mb-2">If enhanced guardrails are not showing, check the debug info in the dialog:</p>
                <ul class="list-disc list-inside ml-4 space-y-1 text-gray-400">
                    <li>Enhanced at top level: Should be "Yes"</li>
                    <li>Enhanced in guardrails: May be "Yes" or "No"</li>
                    <li>Enhanced as property: Should be "Yes"</li>
                </ul>
                <p class="text-gray-300 mt-3">The debug info appears only in development mode.</p>
            </div>
        </div>
        
        <!-- Data Flow -->
        <div class="mt-8 bg-gray-800 p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-4">üîÑ Data Flow</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <h3 class="text-lg font-medium mb-3 text-green-400">1. Creation</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li>‚Ä¢ Enhanced guardrails configured</li>
                        <li>‚Ä¢ Data stored in enhancedGuardrails state</li>
                        <li>‚Ä¢ Sent to backend via API</li>
                        <li>‚Ä¢ Preserved in agent config</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-medium mb-3 text-blue-400">2. Storage</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li>‚Ä¢ Backend processes request</li>
                        <li>‚Ä¢ Enhanced data preserved</li>
                        <li>‚Ä¢ Stored in agent.enhancedGuardrails</li>
                        <li>‚Ä¢ Available for retrieval</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-medium mb-3 text-purple-400">3. Display</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li>‚Ä¢ Agent config dialog loads data</li>
                        <li>‚Ä¢ Checks multiple locations</li>
                        <li>‚Ä¢ Renders enhanced guardrails</li>
                        <li>‚Ä¢ Shows detailed configuration</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Troubleshooting -->
        <div class="mt-8 bg-red-800/20 border border-red-600 p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-4 text-red-400">üîß Troubleshooting</h2>
            <div class="space-y-3 text-gray-300">
                <p><strong>If enhanced guardrails are not showing:</strong></p>
                <ol class="list-decimal list-inside ml-4 space-y-2">
                    <li>Check the browser console for errors</li>
                    <li>Verify the agent was created with enhanced guardrails</li>
                    <li>Check the debug information in the dialog</li>
                    <li>Ensure the backend is properly saving the data</li>
                    <li>Try refreshing the agent list</li>
                    <li>Check if the agent.enhancedGuardrails field exists</li>
                </ol>
                
                <p class="mt-4"><strong>Common Issues:</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>Enhanced guardrails not saved during creation</li>
                    <li>Backend not preserving enhanced data</li>
                    <li>Frontend not checking correct data location</li>
                    <li>Interface mismatch between creation and display</li>
                </ul>
            </div>
        </div>
        
        <!-- Success Criteria -->
        <div class="mt-8 bg-green-800/20 border border-green-600 p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-4 text-green-400">üéØ Success Criteria</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-medium mb-3">Configuration Display</h3>
                    <ul class="space-y-2 text-green-300">
                        <li>‚Ä¢ All blocked keywords visible</li>
                        <li>‚Ä¢ All blocked phrases visible</li>
                        <li>‚Ä¢ Custom rules with descriptions</li>
                        <li>‚Ä¢ Rule patterns and actions shown</li>
                        <li>‚Ä¢ PII redaction settings displayed</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-medium mb-3">Data Persistence</h3>
                    <ul class="space-y-2 text-green-300">
                        <li>‚Ä¢ Settings survive page refresh</li>
                        <li>‚Ä¢ All configured options preserved</li>
                        <li>‚Ä¢ Debug info shows "Yes" for enhanced</li>
                        <li>‚Ä¢ No data loss during save/load</li>
                        <li>‚Ä¢ Consistent display across sessions</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
</html>